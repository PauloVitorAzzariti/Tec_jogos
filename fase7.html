<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fase 7 ‚Äì Classifique Hardware ou Software</title>
  <style>
    body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(to right,#141E30,#243B55);color:#fff;text-align:center}
    h1{margin:16px 8px 8px}
    #hud{display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:6px}
    .pill{border:2px solid #00e676;border-radius:10px;padding:8px 14px;background:rgba(255,255,255,.06);font-weight:700}
    #itens{display:flex;justify-content:center;flex-wrap:wrap;gap:15px;margin-top:20px;min-height:120px;padding:0 12px}
    .item{padding:12px 20px;background:#00e5ff;color:#000;border-radius:8px;font-weight:700;cursor:grab;user-select:none;transition:transform .2s,opacity .2s;touch-action:none}
    .item[draggable="false"]{cursor:not-allowed;opacity:.85}
    .vibrar{animation:vibrar .4s ease}
    @keyframes vibrar{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}
    .container-caixas{display:flex;justify-content:center;gap:40px;margin-top:30px;flex-wrap:wrap;padding:0 12px 12px}
    .caixa{border:3px dashed #fff;padding:40px;border-radius:12px;width:300px;min-height:150px;font-size:18px;position:relative}
    .caixa>span{pointer-events:none;opacity:.9}
    .caixa.highlight{outline:3px solid #00e676;outline-offset:4px}
    .acerto{background:#00c853;color:#fff}
    #popup{display:none;position:fixed;top:30%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.9);padding:25px 30px;border-radius:12px;font-size:18px;max-width:420px;z-index:999;box-shadow:0 0 20px #000;text-align:left}
    #popup strong{color:#00e5ff}
    #popup .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
    #popup button{padding:8px 20px;border:none;background:#ff1744;color:#fff;border-radius:6px;cursor:pointer}
    #popup button.sec{background:#00e676;color:#000}
    #proximo{display:none;margin:26px 0 18px;padding:10px 25px;background:#00e676;color:#000;border:none;font-size:16px;border-radius:8px;cursor:pointer}
    #proximo:hover{background:#00c853}
    .floating{position:fixed;left:0;top:0;transform:translate(-9999px,-9999px);z-index:9999;pointer-events:none;padding:12px 20px;background:#00e5ff;color:#000;border-radius:8px;font-weight:700;box-shadow:0 8px 24px rgba(0,0,0,.5)}
  </style>
</head>
<body>

<h1>üß† Fase 7 ‚Äì Classifique apenas Hardware e Software</h1>

<div id="hud">
  <div class="pill" id="timer">‚è≥ Tempo: 01:00</div>
  <div class="pill" id="progress">Progresso: 0/9</div>
</div>

<div id="itens"></div>

<div class="container-caixas">
  <div class="caixa" id="hardware" ondragover="permitirSoltar(event)" ondrop="dropMouse(event,'hardware')">
    <span>üñ•Ô∏è √Årea de Hardware</span>
  </div>
  <div class="caixa" id="software" ondragover="permitirSoltar(event)" ondrop="dropMouse(event,'software')">
    <span>üíæ √Årea de Software</span>
  </div>
</div>

<div id="popup">
  <div id="mensagem"></div>
  <div class="actions">
    <button class="sec" id="btnTryAgain" style="display:none;">Tentar novamente</button>
    <button onclick="fecharPopup()">Fechar</button>
  </div>
</div>

<button id="proximo" onclick="next()">Avan√ßar para Fase 8</button>

<script>
  // ----- Dados -----
  const listaItens = [
    { nome: "Teclado", tipo: "hardware" },
    { nome: "Mouse", tipo: "hardware" },
    { nome: "Monitor", tipo: "hardware" },
    { nome: "CPU", tipo: "hardware" },
    { nome: "Placa-m√£e", tipo: "hardware" },
    { nome: "Word", tipo: "software" },
    { nome: "Excel", tipo: "software" },
    { nome: "Chrome", tipo: "software" },
    { nome: "PowerPoint", tipo: "software" },
    { nome: "Camiseta", tipo: "nenhum" },
    { nome: "Martelo", tipo: "nenhum" },
    { nome: "Banana", tipo: "nenhum" },
    { nome: "Chave de fenda", tipo: "nenhum" },
    { nome: "Sapato", tipo: "nenhum" },
    { nome: "P√£o", tipo: "nenhum" }
  ];
  const totalCorretos = 9;
  let acertos = 0, jogoEncerrado = false;

  const itensDiv = document.getElementById("itens");
  const boxHardware = document.getElementById("hardware");
  const boxSoftware = document.getElementById("software");
  const progressEl = document.getElementById("progress");
  const proximoBtn = document.getElementById("proximo");
  const btnTryAgain = document.getElementById("btnTryAgain");

  // ----- Timer 1 min -----
  const DURACAO = 60; let restante = DURACAO; let tId = null;
  const timerEl = document.getElementById("timer");
  const fmt = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  function atualizarTimer(){ timerEl.textContent = `‚è≥ Tempo: ${fmt(restante)}`; }
  function iniciarTimer(){
    atualizarTimer();
    tId = setInterval(()=>{ if(jogoEncerrado){clearInterval(tId);return}
      restante--; atualizarTimer();
      if(restante<=0){ clearInterval(tId); tempoEsgotado(); }
    },1000);
  }
  function tempoEsgotado(){
    jogoEncerrado = true; bloquearTodos(true);
    if(navigator.vibrate) navigator.vibrate(200);
    mostrarPopup("‚õî <strong>Tempo esgotado!</strong> Voc√™ perdeu esta fase. Tente novamente.");
    btnTryAgain.style.display = "inline-block";
  }

  // ----- Render -----
  listaItens.sort(()=>0.5 - Math.random());
  listaItens.forEach(d=>{
    const el = document.createElement('div');
    el.className = "item";
    el.textContent = d.nome;
    el.dataset.tipo = d.tipo;
    el.setAttribute('draggable','true');
    // Drag nativo (mouse): guardo a refer√™ncia do elemento
    el.addEventListener('dragstart', ()=> { if(!jogoEncerrado) currentDraggedEl = el; });
    itensDiv.appendChild(el);
  });

  // ----- Drag & Drop mouse (usando refer√™ncia do elemento) -----
  let currentDraggedEl = null;
  function permitirSoltar(e){ if(!jogoEncerrado) e.preventDefault(); }
  function dropMouse(e, alvo){
    if(jogoEncerrado) return;
    e.preventDefault();
    if(!currentDraggedEl) return;
    processarDropElemento(currentDraggedEl, alvo);
    currentDraggedEl = null;
  }
  window.permitirSoltar = permitirSoltar;
  window.dropMouse = dropMouse;

  // ----- L√≥gica unificada de drop (move o pr√≥prio card) -----
  function processarDropElemento(el, tipoAlvo){
    const tipo = el.dataset.tipo;
    if(tipo === 'nenhum'){
      mostrarPopup("‚ùå Este item n√£o pertence a nenhuma das categorias. Ignore.");
      animarErro(el);
      return;
    }
    if(tipo !== tipoAlvo){
      const dica = tipoAlvo === "hardware"
        ? "‚ùå Esse objeto n√£o √© um hardware!<br><br>üí° <strong>Hardware</strong> √© a parte f√≠sica do computador: teclado, mouse, monitor, etc."
        : "‚ùå Esse objeto n√£o √© um software!<br><br>üí° <strong>Software</strong> s√£o os programas: Word, Excel, navegadores, etc.";
      mostrarPopup(dica);
      animarErro(el);
      return;
    }
    // Move o pr√≥prio item para a caixa alvo
    (tipoAlvo === 'hardware' ? boxHardware : boxSoftware).appendChild(el);
    el.classList.add('acerto');
    el.setAttribute('draggable','false');
    acertos++;
    progressEl.textContent = `Progresso: ${acertos}/${totalCorretos}`;
    verificarAcertos();
  }

  function verificarAcertos(){
    if(acertos >= totalCorretos){
      jogoEncerrado = true; clearInterval(tId); bloquearTodos(true);
      mostrarPopup("‚úÖ Parab√©ns! Voc√™ classificou todos os itens corretamente!");
      proximoBtn.style.display = "inline-block";
    }
  }
  function bloquearTodos(flag){
    document.querySelectorAll('.item').forEach(el=> el.setAttribute('draggable', String(!flag)));
  }
  function animarErro(el){
    el.classList.add('vibrar'); if(navigator.vibrate) navigator.vibrate(120);
    setTimeout(()=> el.classList.remove('vibrar'), 600);
  }

  // ----- Popup -----
  function mostrarPopup(msg){ document.getElementById("mensagem").innerHTML = msg; document.getElementById("popup").style.display="block"; }
  function fecharPopup(){ document.getElementById("popup").style.display="none"; }
  window.fecharPopup = fecharPopup;
  btnTryAgain.addEventListener('click', ()=> location.reload());
  function next(){ window.location.href = "fase8.html"; }
  window.next = next;

  // ----- Fallback TOUCH (Pointer Events) movendo o pr√≥prio card -----
  let floating = null, origemEl = null, origemParent = null, hoverTarget = null;
  document.addEventListener('pointerdown', (e)=>{
    const item = e.target.closest('.item');
    if(!item || jogoEncerrado) return;

    // Desativa drag nativo durante o toque pra n√£o conflitar
    item.setAttribute('draggable','false');

    origemEl = item;
    origemParent = item.parentElement;

    floating = document.createElement('div');
    floating.className = 'floating';
    floating.textContent = item.textContent;
    document.body.appendChild(floating);

    moveFloating(e.clientX, e.clientY);
    item.setPointerCapture?.(e.pointerId);
    window.addEventListener('pointermove', onPointerMove, {passive:false});
    window.addEventListener('pointerup', onPointerUp, {once:true});
  }, {passive:true});

  function onPointerMove(e){
    e.preventDefault();
    moveFloating(e.clientX, e.clientY);
  }
  function onPointerUp(e){
    window.removeEventListener('pointermove', onPointerMove);
    floating?.remove(); floating = null;
    boxHardware.classList.remove('highlight');
    boxSoftware.classList.remove('highlight');

    // Reativa para mouse depois do toque
    origemEl?.setAttribute('draggable','true');

    if(!origemEl){ hoverTarget=null; return; }

    if(hoverTarget){
      // Move o pr√≥prio card para a caixa correta
      processarDropElemento(origemEl, hoverTarget);
    } else {
      // Volta pro lugar original se n√£o estiver sobre alvo
      origemParent?.appendChild(origemEl);
    }
    origemEl = origemParent = null; hoverTarget = null;
  }

  function moveFloating(x,y){
    if(!floating) return;
    const rect = floating.getBoundingClientRect();
    const ox = rect.width/2, oy = rect.height/2;
    floating.style.transform = `translate(${x-ox}px, ${y-oy}px)`;

    // Highlight/hover target por hit-test
    const overH = hit(boxHardware,x,y);
    const overS = hit(boxSoftware,x,y);
    boxHardware.classList.toggle('highlight', overH);
    boxSoftware.classList.toggle('highlight', overS);
    hoverTarget = overH ? 'hardware' : (overS ? 'software' : null);
  }
  function hit(elem,x,y){
    const r = elem.getBoundingClientRect();
    return x>=r.left && x<=r.right && y>=r.top && y<=r.bottom;
  }

  // Start
  iniciarTimer();
  progressEl.textContent = `Progresso: ${acertos}/${totalCorretos}`;
</script>

</body>
</html>
